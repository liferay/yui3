YUI.add("exec-command",function(N,e){var i=function(){i.superclass.constructor.apply(this,arguments)},t=function(e,t,n){var i,o,s,r=this.getInstance(),c=r.config.doc,a=c.selection.createRange();c.queryCommandValue(e)&&(i=a.htmlText,o=new RegExp(n,"g"),i.match(o))&&(i=i.replace(n+";","").replace(n,""),a.pasteHTML('<var id="yui-ie-bs">'),o=c.getElementById("yui-ie-bs"),n=c.createElement("div"),s=c.createElement(t),n.innerHTML=i,o.parentNode!==r.config.doc.body&&(o=o.parentNode),t=n.childNodes,o.parentNode.replaceChild(s,o),N.each(t,function(e){s.appendChild(e)}),a.collapse(),a.moveToElementText&&a.moveToElementText(s),a.select()),this._command(e)};N.extend(i,N.Base,{_lastKey:null,_inst:null,command:function(e,t){var n=i.COMMANDS[e];return n?n.call(this,e,t):this._command(e,t)},_command:function(e,t){var n=this.getInstance();try{try{n.config.doc.execCommand("styleWithCSS",null,1)}catch(i){try{n.config.doc.execCommand("useCSS",null,0)}catch(o){}}n.config.doc.execCommand(e,null,t)}catch(s){}},getInstance:function(){return this._inst||(this._inst=this.get("host").getInstance()),this._inst},initializer:function(){N.mix(this.get("host"),{execCommand:function(e,t){return this.exec.command(e,t)},_execCommand:function(e,t){return this.exec._command(e,t)}}),this.get("host").on("dom:keypress",N.bind(function(e){this._lastKey=e.keyCode},this))},_wrapContent:function(e,t){return!(!this.getInstance().host.editorPara||t)?e="<p>"+e+"</p>":e+="<br>",e}},{NAME:"execCommand",NS:"exec",ATTRS:{host:{value:!1}},COMMANDS:{wrap:function(e,t){return(new(this.getInstance().EditorSelection)).wrapContent(t)},inserthtml:function(e,t){var n=this.getInstance();if(n.EditorSelection.hasCursor()||N.UA.ie)return(new n.EditorSelection).insertContent(t);this._command("inserthtml",t)},insertandfocus:function(e,t){var n,i=this.getInstance();return i.EditorSelection.hasCursor()?(t+=i.EditorSelection.CURSOR,n=this.command("inserthtml",t),(new i.EditorSelection).focusCursor(!0,!0)):this.command("inserthtml",t),n},insertbr:function(){var n=this.getInstance(),e=new n.EditorSelection,t="<var>|</var>",i=null,o=n.EditorSelection.ROOT,s=N.UA.webkit?"span.Apple-style-span,var":"var",r=function(e){var t=n.Node.create("<br>");return e.insert(t,"before"),t};e._selection.pasteHTML?e._selection.pasteHTML(t):this._command("inserthtml",t),o.all(s).each(function(e){var t=!0;(t=N.UA.webkit&&(t=!1,"|"===e.get("innerHTML"))?!0:t)&&((i=r(e)).previous()&&i.previous().test("br")||!N.UA.gecko||(t=i.cloneNode(),i.insert(t,"after"),i=t),e.remove())}),N.UA.webkit&&i&&(r(i),e.selectNode(i))},insertimage:function(e,t){return this.command("inserthtml",'<img src="'+t+'">')},addclass:function(e,t){return(new(this.getInstance().EditorSelection)).getSelected().addClass(t)},removeclass:function(e,t){return(new(this.getInstance().EditorSelection)).getSelected().removeClass(t)},forecolor:function(e,t){var n,i=this.getInstance(),o=new i.EditorSelection;if(N.UA.ie||this._command("useCSS",!1),i.EditorSelection.hasCursor())return o.isCollapsed?(o.anchorNode&&"&nbsp;"===o.anchorNode.get("innerHTML")?(o.anchorNode.setStyle("color",t),n=o.anchorNode):(n=this.command("inserthtml",'<span style="color: '+t+'">'+i.EditorSelection.CURSOR+"</span>"),o.focusCursor(!0,!0)),n):this._command(e,t);this._command(e,t)},backcolor:function(e,t){var n,i=this.getInstance(),o=new i.EditorSelection;if((N.UA.gecko||N.UA.opera)&&(e="hilitecolor"),N.UA.ie||this._command("useCSS",!1),i.EditorSelection.hasCursor())return o.isCollapsed?(o.anchorNode&&"&nbsp;"===o.anchorNode.get("innerHTML")?(o.anchorNode.setStyle("backgroundColor",t),n=o.anchorNode):(n=this.command("inserthtml",'<span style="background-color: '+t+'">'+i.EditorSelection.CURSOR+"</span>"),o.focusCursor(!0,!0)),n):this._command(e,t);this._command(e,t)},hilitecolor:function(){return i.COMMANDS.backcolor.apply(this,arguments)},fontname2:function(e,t){this._command("fontname",t);var n=new(this.getInstance().EditorSelection);n.isCollapsed&&32!==this._lastKey&&n.anchorNode.test("font")&&n.anchorNode.set("face",t)},fontsize2:function(e,t){this._command("fontsize",t);var n=this.getInstance(),i=new n.EditorSelection;i.isCollapsed&&i.anchorNode&&32!==this._lastKey&&(N.UA.webkit&&i.anchorNode.getStyle("lineHeight")&&i.anchorNode.setStyle("lineHeight",""),i.anchorNode.test("font")?i.anchorNode.set("size",t):N.UA.gecko&&(t=i.anchorNode.ancestor(n.EditorSelection.DEFAULT_BLOCK_TAG))&&t.setStyle("fontSize",""))},insertunorderedlist:function(){this.command("list","ul")},insertorderedlist:function(){this.command("list","ol")},list:function(e,t){var n,i,o,s,r,c,a,l,d,h,u=this.getInstance(),m=this,f="dir",g="yui3-touched",p=!!u.host.editorPara,S=u.EditorSelection.ROOT,C=new u.EditorSelection;e="insert"+("ul"===t?"un":"")+"orderedlist",N.UA.ie&&N.UA.ie<11&&!C.isCollapsed?(o=C._selection,n=o.htmlText,(h=u.Node.create(n)||S).test("li")||h.one("li")?this._command(e,null):(h.test(t)?(s=o.item?o.item(0):o.parentElement(),l=(h=u.one(s)).all("li"),r="<div>",l.each(function(e){r=m._wrapContent(e.get("innerHTML"))}),r+="</div>",l=u.Node.create(r),(h=h.get("parentNode").test("div")?h.get("parentNode"):h)&&h.hasAttribute(f)&&(p?l.all("p"):l).setAttribute(f,h.getAttribute(f)),p?h.replace(l.get("innerHTML")):h.replace(l),o.moveToElementText&&o.moveToElementText(l._node)):((c=(c=N.one(o.parentElement())).test(u.EditorSelection.BLOCKS)?c:c.ancestor(u.EditorSelection.BLOCKS))&&c.hasAttribute(f)&&(i=c.getAttribute(f)),-1<n.indexOf("<br>")?n=n.split(/<br>/i):(h=u.Node.create(n),(ps=h?h.all("p"):null)&&ps.size()?(n=[],ps.each(function(e){n.push(e.get("innerHTML"))})):n=[n]),a="<"+t+' id="ie-list">',N.each(n,function(e){var t=u.Node.create(e);t&&t.test("p")&&(t.hasAttribute(f)&&(i=t.getAttribute(f)),e=t.get("innerHTML")),a+="<li>"+e+"</li>"}),a+="</"+t+">",o.pasteHTML(a),(s=u.config.doc.getElementById("ie-list")).id="",i&&s.setAttribute(f,i),o.moveToElementText&&o.moveToElementText(s)),o.select())):N.UA.ie&&N.UA.ie<11?(c=u.one(C._selection.parentElement())).test("p")&&(
c&&c.hasAttribute(f)&&(i=c.getAttribute(f)),""===(n=N.EditorSelection.getText(c)))?(l=i?' dir="'+i+'"':"",a=u.Node.create(N.Lang.sub("<{tag}{dir}><li></li></{tag}>",{tag:t,dir:l})),c.replace(a),C.selectNode(a.one("li"))):this._command(e,null):(S.all(t).addClass(g),(c=(c=C.anchorNode.test(u.EditorSelection.BLOCKS)?C.anchorNode:C.anchorNode.ancestor(u.EditorSelection.BLOCKS))||C.anchorNode.one(u.EditorSelection.BLOCKS))&&c.hasAttribute(f)&&(i=c.getAttribute(f)),c&&c.test(t)?(d=c.ancestor("p"),n=u.Node.create("<div/>"),(s=c.all("li")).each(function(e){n.append(m._wrapContent(e.get("innerHTML"),d))}),i&&(p?n.all("p"):n).setAttribute(f,i),h=(n=p?u.Node.create(n.get("innerHTML")):n).get("firstChild"),c.replace(n),C.selectNode(h)):this._command(e,null),a=S.all(t),i&&a.size()&&a.each(function(e){e.hasClass(g)||e.setAttribute(f,i)}),a.removeClass(g))},justify:function(e,t){var n,i,o;N.UA.webkit?(o=(n=new(i=this.getInstance()).EditorSelection).anchorNode.getStyle("backgroundColor"),this._command(t),(n=new i.EditorSelection).anchorNode.test("div")&&(i="<span>"+n.anchorNode.get("innerHTML")+"</span>",n.anchorNode.set("innerHTML",i),n.anchorNode.one("span").setStyle("backgroundColor",o),n.selectNode(n.anchorNode.one("span")))):this._command(t)},justifycenter:function(){this.command("justify","justifycenter")},justifyleft:function(){this.command("justify","justifyleft")},justifyright:function(){this.command("justify","justifyright")},justifyfull:function(){this.command("justify","justifyfull")}}}),N.UA.ie&&N.UA.ie<11&&(i.COMMANDS.bold=function(){t.call(this,"bold","b","FONT-WEIGHT: bold")},i.COMMANDS.italic=function(){t.call(this,"italic","i","FONT-STYLE: italic")},i.COMMANDS.underline=function(){t.call(this,"underline","u","TEXT-DECORATION: underline")}),N.namespace("Plugin"),N.Plugin.ExecCommand=i},"@VERSION@",{requires:["frame"]});