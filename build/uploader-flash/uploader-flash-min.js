YUI.add("uploader-flash",function(d,e){var t,l=d.Lang.sub,i=d.Uploader.Queue,f=(d.Event,d.SWFDetect),c=d.Lang,p=d.UA,_=d.Node,b=d.Escape,g="http://fpdownload.macromedia.com/pub/flashplayer/update/current/swf/autoUpdater.swf?"+Math.random(),w={align:"",allowFullScreen:"",allowNetworking:"",allowScriptAccess:"",base:"",bgcolor:"",loop:"",menu:"",name:"",play:"",quality:"",salign:"",scale:"",tabindex:"",wmode:""};function s(e,t,s){var i,l,n,a,o,u,r,h;if(this._id=d.guid("yuiswf"),i=this._id,e=_.one(e),h=(((s=s||{}).version||"10.0.22")+"").split("."),h=f.isFlashVersionAtLeast(parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)),t=(l=f.isFlashVersionAtLeast(8,0,0)&&!h&&s.useExpressInstall)?g:t,n="<object ",a="yId="+d.id+"&YUISwfId="+i+"&YUIBridgeCallback=SWF.eventHandler&allowedDomain="+document.location.hostname,d.SWF._instances[i]=this,e&&(h||l)&&t){for(o in n+='id="'+i+'" ',p.ie?n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ':n+='type="application/x-shockwave-flash" data="'+b.html(t)+'" ',0,n+='width="100%" height="100%">',p.ie&&(n+='<param name="movie" value="'+b.html(t)+'"/>'),s.fixedAttributes)w.hasOwnProperty(o)&&(n+='<param name="'+b.html(o)+'" value="'+b.html(s.fixedAttributes[o])+'"/>');for(u in s.flashVars)r=s.flashVars[u],c.isString(r)&&(a+="&"+b.html(u)+"="+b.html(encodeURIComponent(r)));a&&(n+='<param name="flashVars" value="'+a+'"/>'),e.set("innerHTML",n+="</object>"),this._swf=_.one("#"+i)}else h={type:"wrongflashversion"},this.publish("wrongflashversion",{fireOnce:!0}),this.fire("wrongflashversion",h)}function n(){n.superclass.constructor.apply(this,arguments)}s._instances=s._instances||{},s.eventHandler=function(e,t){s._instances[e]._eventHandler(t)},s.prototype={_eventHandler:function(e){"swfReady"===e.type?(this.publish("swfReady",{fireOnce:!0}),this.fire("swfReady",e)):"log"!==e.type&&this.fire(e.type,e)},callSWF:function(e,t){return t=t||[],this._swf._node[e]?this._swf._node[e].apply(this._swf._node,t):null},toString:function(){return"SWF "+this._id}},d.augment(s,d.EventTarget),d.SWF=s,d.extend(t=function(e){t.superclass.constructor.apply(this,arguments)},d.Base,{initializer:function(e){this.get("id")||this._set("id",d.guid("file"))},_swfEventHandler:function(e){if(e.id===this.get("id"))switch(e.type){case"uploadstart":this.fire("uploadstart",{uploader:this.get("uploader")});break;case"uploadprogress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.bytesLoaded,bytesTotal:e.bytesTotal,percentLoaded:Math.min(100,Math.round(1e4*e.bytesLoaded/e.bytesTotal)/100)}),this._set("bytesUploaded",e.bytesLoaded);break;case"uploadcomplete":this.fire("uploadfinished",{originEvent:e});break;case"uploadcompletedata":this.fire("uploadcomplete",{originEvent:e,data:e.data});break;case"uploadcancel":this.fire("uploadcancel",{originEvent:e});break;case"uploaderror":this.fire("uploaderror",{originEvent:e,status:e.status,statusText:e.message,source:e.source})}},startUpload:function(e,t,s){var i,l;this.get("uploader")&&(i=this.get("uploader"),s=s||"Filedata",l=this.get("id"),t=t||null,this._set("bytesUploaded",0),i.on("uploadstart",this._swfEventHandler,this),i.on("uploadprogress",this._swfEventHandler,this),i.on("uploadcomplete",this._swfEventHandler,this),i.on("uploadcompletedata",this._swfEventHandler,this),i.on("uploaderror",this._swfEventHandler,this),i.callSWF("upload",[l,e,t,s]))},cancelUpload:function(){this.get("uploader")&&(this.get("uploader").callSWF("cancel",[this.get("id")]),this.fire("uploadcancel"))}},{NAME:"file",TYPE:"flash",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},uploader:{writeOnce:"initOnly",value:null}}}),d.FileFlash=t,d.UploaderFlash=d.extend(n,d.Widget,{_buttonState:"up",_buttonFocus:!1,_swfContainerId:null,_swfReference:null,queue:null,_tabElementBindings:null,initializer:function(){this._swfContainerId=d.guid("uploader"),this._swfReference=null,this.queue=null,this._buttonState="up",this._buttonFocus=null,this._tabElementBindings=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("mouseenter"),this.publish("mouseleave"),this.publish("mousedown"),this.publish("mouseup"),this.publish("click")},renderUI:function(){var e=this.get("boundingBox"),t=this.get("contentBox"),s=this.get("selectFilesButton"),i=d.Node.create(l(n.FLASH_CONTAINER,{swfContainerId:this._swfContainerId}));e.setStyle("position","relative"),s.setStyles({width:"100%",height:"100%"}),t.append(s),t.append(i),this._swfReference=new d.SWF(i,this.get("swfURL"),{version:"10.0.45",fixedAttributes:{wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",scale:"noscale"}})},bindUI:function(){this._swfReference.on("swfReady",function(){this._setMultipleFiles(),this._setFileFilters(),this._triggerEnabled(),this._attachTabElements(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("tabElementsChange",this._attachTabElements)},this),this._swfReference.on("fileselect",this._updateFileList,this),this._swfReference.on("mouseenter",function(){this.fire("mouseenter"),this._setButtonClass("hover",!0),"down"===this._buttonState&&this._setButtonClass("active",!0)},this),this._swfReference.on("mouseleave",function(){this.fire("mouseleave"),this._setButtonClass("hover",!1),this._setButtonClass("active",!1)},this),this._swfReference.on("mousedown",function(){this.fire("mousedown"),this._buttonState="down",this._setButtonClass("active",!0)},this),this._swfReference.on("mouseup",function(){
this.fire("mouseup"),this._buttonState="up",this._setButtonClass("active",!1)},this),this._swfReference.on("click",function(){this.fire("click"),this._buttonFocus=!0,this._setButtonClass("focus",!0),d.one("body").focus(),this._swfReference._swf.focus()},this)},_attachTabElements:function(){var e,t;null!==this.get("tabElements")&&null!==this.get("tabElements").from&&null!==this.get("tabElements").to?(null!==this._tabElementBindings?(this._tabElementBindings.from.detach(),this._tabElementBindings.to.detach(),this._tabElementBindings.tabback.detach(),this._tabElementBindings.tabforward.detach(),this._tabElementBindings.focus.detach(),this._tabElementBindings.blur.detach()):this._tabElementBindings={},e=d.one(this.get("tabElements").from),t=d.one(this.get("tabElements").to),this._tabElementBindings.from=e.on("keydown",function(e){9!==e.keyCode||e.shiftKey||(e.preventDefault(),this._swfReference._swf.setAttribute("tabindex",0),this._swfReference._swf.setAttribute("role","button"),this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel")),this._swfReference._swf.focus())},this),this._tabElementBindings.to=t.on("keydown",function(e){9===e.keyCode&&e.shiftKey&&(e.preventDefault(),this._swfReference._swf.setAttribute("tabindex",0),this._swfReference._swf.setAttribute("role","button"),this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel")),this._swfReference._swf.focus())},this),this._tabElementBindings.tabback=this._swfReference.on("tabback",function(){this._swfReference._swf.blur(),setTimeout(function(){e.focus()},30)},this),this._tabElementBindings.tabforward=this._swfReference.on("tabforward",function(){this._swfReference._swf.blur(),setTimeout(function(){t.focus()},30)},this),this._tabElementBindings.focus=this._swfReference._swf.on("focus",function(){this._buttonFocus=!0,this._setButtonClass("focus",!0)},this),this._tabElementBindings.blur=this._swfReference._swf.on("blur",function(){this._buttonFocus=!1,this._setButtonClass("focus",!1)},this)):null!==this._tabElementBindings&&(this._tabElementBindings.from.detach(),this._tabElementBindings.to.detach(),this._tabElementBindings.tabback.detach(),this._tabElementBindings.tabforward.detach(),this._tabElementBindings.focus.detach(),this._tabElementBindings.blur.detach())},_setButtonClass:function(e,t){t?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[e]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[e])},_setFileFilters:function(){this._swfReference&&0<this.get("fileFilters").length&&this._swfReference.callSWF("setFileFilters",[this.get("fileFilters")])},_setMultipleFiles:function(){this._swfReference&&this._swfReference.callSWF("setAllowMultipleFiles",[this.get("multipleFiles")])},_triggerEnabled:function(){this.get("enabled")?(this._swfReference.callSWF("enable"),this._swfReference._swf.setAttribute("aria-disabled","false"),this._setButtonClass("disabled",!1)):(this._swfReference.callSWF("disable"),this._swfReference._swf.setAttribute("aria-disabled","true"),this._setButtonClass("disabled",!0))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(e){return this._fileList=e.concat(),this._fileList.concat()},_updateFileList:function(e){d.one("body").focus(),this._swfReference._swf.focus();var e=e.fileList,s=[],t=[],i=this._swfReference,l=this.get("fileFilterFunction");d.each(e,function(e){var t={};t.id=e.fileId,t.name=e.fileReference.name,t.size=e.fileReference.size,t.type=e.fileReference.type,t.dateCreated=e.fileReference.creationDate,t.dateModified=e.fileReference.modificationDate,t.uploader=i,s.push(t)}),l?d.each(s,function(e){e=new d.FileFlash(e);l(e)&&t.push(e)}):d.each(s,function(e){t.push(new d.FileFlash(e))}),0<t.length&&(e=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?e.concat(t):t),this.fire("fileselect",{fileList:t}))},_uploadEventHandler:function(e){switch(e.type){case"file:uploadstart":this.fire("fileuploadstart",e);break;case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",e);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",e)}},upload:function(e,t,s){var t=t||this.get("uploadURL"),s=s||this.get("postVarsPerFile"),i=e.get("id"),s=s.hasOwnProperty(i)?s[i]:s;e instanceof d.FileFlash&&(e.on("uploadstart",this._uploadEventHandler,this),e.on("uploadprogress",this._uploadEventHandler,this),e.on("uploadcomplete",this._uploadEventHandler,this),e.on("uploaderror",this._uploadEventHandler,this),e.on("uploadcancel",this._uploadEventHandler,this),e.startUpload(t,s,this.get("fileFieldName")))},uploadAll:function(e,t){this.uploadThese(this.get("fileList"),e,t)},uploadThese:function(e,t,s){this.queue||(t=t||this.get("uploadURL"),s=s||this.get("postVarsPerFile"),this.queue=new i({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:e,uploadURL:t,perFileParameters:s,retryCount:this.get("retryCount")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("alluploadscancelled",function(){this.queue=null},this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart"))}},{FLASH_CONTAINER:'<div id="{swfContainerId}" style="position:absolute; top:0px; left: 0px; margin: 0; padding: 0; border: 0; width:100%; height:100%"></div>',
SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' tabindex='-1'>{selectButtonLabel}</button>",TYPE:"flash",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},enabled:{value:!0},errorAction:{value:"continue",validator:function(e){return e===i.CONTINUE||e===i.STOP||e===i.RESTART_ASAP||e===i.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return d.Node.create(l(d.UploaderFlash.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel")}))}},simLimit:{value:2,validator:function(e){return 2<=e&&e<=5}},swfURL:{valueFn:function(){var e="flashuploader.swf";return 0<d.UA.ie?e+"?t="+d.guid("uploader"):e}},tabElements:{value:null},uploadURL:{value:""},retryCount:{value:3}}}),d.UploaderFlash.Queue=i},"@VERSION@",{requires:["swfdetect","escape","widget","base","cssbutton","node","event-custom","uploader-queue"]});