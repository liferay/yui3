YUI.add("datatable-body",function(h,e){var o=h.Lang,n=o.isArray,s=o.isNumber,i=o.isString,u=o.sub,g=h.Escape.html,t=h.Array,r=h.bind,a=h.Object,l=/\{value\}/g,c="contentUpdate",d={above:[-1,0],below:[1,0],next:[0,1],prev:[0,-1],previous:[0,-1]};h.namespace("DataTable").BodyView=h.Base.create("tableBody",h.View,[],{CELL_TEMPLATE:'<td {headers} class="{className}">{content}</td>',ROW_TEMPLATE:'<tr id="{rowId}" data-yui3-record="{clientId}" class="{rowClass}">{content}</tr>',TBODY_TEMPLATE:'<tbody class="{className}"></tbody>',getCell:function(e,t){var a,s,r=this.tbodyNode;return e&&r&&(n(e)?s=(a=r.get("children").item(e[0]))&&a.get("children").item(e[1]):e._node&&(s=e.ancestor("."+this.getClassName("cell"),!0)),s&&t&&(e=r.get("firstChild.rowIndex"),i(t)&&(d[t]||h.error("Unrecognized shift: "+t,null,"datatable-body"),t=d[t]),n(t)&&(e=s.get("parentNode.rowIndex")+t[0]-e,a=r.get("children").item(e),e=s.get("cellIndex")+t[1],s=a&&a.get("children").item(e)))),s||null},getClassName:function(){var e=this.host;return e&&e.getClassName?e.getClassName.apply(e,arguments):((e=t(arguments)).unshift(this.constructor.NAME),h.ClassNameManager.getClassName.apply(h.ClassNameManager,e))},getRecord:function(e){var t,a=this.get("modelList"),s=this.tbodyNode,r=null;return(t=s&&(e=i(e)?s.one("#"+e):e)&&e._node?(r=e.ancestor(function(e){return e.get("parentNode").compareTo(s)},!0))&&a.getByClientId(r.getData("yui3-record")):t)||null},getRow:function(e){var t=this.tbodyNode,a=null;return t&&(e=e&&(this._idMap[e.get?e.get("clientId"):e]||e),a=s(e)?t.get("children").item(e):t.one("#"+e)),a},render:function(){var e=this.get("container"),t=this.get("modelList"),a=this.get("columns"),s=this.tbodyNode||(this.tbodyNode=this._createTBodyNode());return this._createRowTemplate(a),t&&(s.setHTML(this._createDataHTML(a)),this._applyNodeFormatters(s,a)),s.get("parentNode")!==e&&e.appendChild(s),this.bindUI(),this},refreshRow:function(e,t,a){for(var s,r=a.length,n=0;n<r;n++)null!==(s=this.getColumn(a[n]))&&(s=e.one("."+this.getClassName("col",s._id||s.key)),this.refreshCell(s,t));return this},refreshCell:function(e,t,a){var s,r,n,o=t.toJSON();return e=this.getCell(e),t=t||this.getRecord(e),(a=a||this.getColumn(e)).nodeFormatter?!(n={cell:e.one("."+this.getClassName("liner"))||e,column:a,data:o,record:t,rowIndex:this._getRowIndex(e.ancestor("tr")),td:e,value:o[a.key]})===(keep=a.nodeFormatter.call(host,n))&&e.destroy(!0):a.formatter?((r=(a=a._formatterFn?a:this._setColumnsFormatterFn([a])[0])._formatterFn||null)&&(n={value:o[a.key],data:o,column:a,record:t,className:"",rowClass:"",rowIndex:this._getRowIndex(e.ancestor("tr"))},(s=r.call(this.get("host"),n))===undefined&&(s=n.value)),s!==undefined&&null!==s&&""!==s||(s=a.emptyCellValue||"")):s=o[a.key]||a.emptyCellValue||"",e.setHTML(a.allowHTML?s:h.Escape.html(s)),this},getColumn:function(t){if(t&&t._node&&(t=t.get("className").match(new RegExp(this.getClassName("col")+"-([^ ]*)"))[1]),this.host)return this.host._columnMap[t]||null;var e=this.get("columns"),a=null;return h.Array.some(e,function(e){if((e._id||e.key)===t)return a=e,!0}),a},_afterColumnsChange:function(){this.render()},_afterDataChange:function(e){for(var t,a,s,r=(e.type.match(/:(add|change|remove)$/)||[])[1],n=e.index,o=this.get("columns"),i=e.changed&&h.Object.keys(e.changed),l=0,d=o.length;l<d;l++)if((t=o[l]).hasOwnProperty("nodeFormatter"))return this.render(),void this.fire(c);switch(r){case"change":for(l=0,d=o.length;l<d;l++)a=(t=o[l]).key,t.formatter&&!e.changed[a]&&i.push(a);this.refreshRow(this.getRow(e.target),e.target,i);break;case"add":n=Math.min(n,this.get("modelList").size()-1),this._setColumnsFormatterFn(o),s=h.Node.create(this._createRowHTML(e.model,n,o)),this.tbodyNode.insert(s,n),this._restripe(n);break;case"remove":this.getRow(n).remove(!0),this._restripe(n-1);break;default:this.render()}this.fire(c)},_restripe:function(e){var t,a=this._restripeTask;e=Math.max(0|e,0),a?a.index=Math.min(a.index,e):(t=this)._restripeTask={timer:setTimeout(function(){var a,s,r;t&&!t.get("destroy")&&t.tbodyNode&&t.tbodyNode.inDoc()&&(a=[t.CLASS_ODD,t.CLASS_EVEN],s=[t.CLASS_EVEN,t.CLASS_ODD],r=t._restripeTask.index,t.tbodyNode.get("childNodes").slice(r).each(function(e,t){e.replaceClass.apply(e,(r+t)%2?s:a)})),t._restripeTask=null},0),index:e}},_afterModelListChange:function(){var e=this._eventHandles;e.dataChange&&(e.dataChange.detach(),delete e.dataChange,this.bindUI()),this.tbodyNode&&this.render()},_applyNodeFormatters:function(e,d){for(var h,c=this.host||this,t=this.get("modelList"),m=[],u="."+this.getClassName("liner"),a=0,s=d.length;a<s;++a)d[a].nodeFormatter&&m.push(a);t&&m.length&&(h=e.get("childNodes"),t.each(function(e,t){var a,s,r,n,o,i,l={data:e.toJSON(),record:e,rowIndex:t},t=h.item(t);if(t)for(o=t.get("childNodes"),a=0,s=m.length;a<s;++a)(i=o.item(m[a]))&&(n=(r=l.column=d[m[a]]).key||r.id,l.value=e.get(n),l.td=i,l.cell=i.one(u)||i,!1===r.nodeFormatter.call(c,l)&&i.destroy(!0))}))},bindUI:function(){var e=this._eventHandles,t=this.get("modelList"),a=t.model.NAME+":change";e.columnsChange||(e.columnsChange=this.after("columnsChange",r("_afterColumnsChange",this))),t&&!e.dataChange&&(e.dataChange=t.after(["add","remove","reset",a],r("_afterDataChange",this)))},_createDataHTML:function(a){var e=this.get("modelList"),s="";return e&&e.each(function(e,t){s+=this._createRowHTML(e,t,a)},this),s},_createRowHTML:function(e,t,a){for(var s,r,n,o,i=e.toJSON(),l=e.get("clientId"),d={rowId:this._getRowId(l),clientId:l,rowClass:t%2?this.CLASS_ODD:this.CLASS_EVEN},h=this.host||this,c=0,m=a.length;c<m;++c)n=i[(s=a[c]).key],d[(r=s._id||s.key)+"-className"]="",s._formatterFn&&((n=s._formatterFn.call(h,o={value:n,data:i,column:s,record:e,className:"",rowClass:"",rowIndex:t}))===undefined&&(n=o.value),d[r+"-className"]=o.className,d.rowClass+=" "+o.rowClass),d.hasOwnProperty(r)&&!i.hasOwnProperty(s.key)||(n!==undefined&&null!==n&&""!==n||(n=s.emptyCellValue||""),d[r]=s.allowHTML?n:g(n));return d.rowClass=d.rowClass.replace(
/\s+/g," "),u(this._rowTemplate,d)},_getRowIndex:function(e){var t=this.tbodyNode,a=1;if(t&&e){if(e.ancestor("tbody")!==t)return null;for(;e=e.previous();)a++}return a},_createRowTemplate:function(e){var t,a,s,r,n,o="",i=this.CELL_TEMPLATE;for(this._setColumnsFormatterFn(e),t=0,a=e.length;t<a;++t)r=(s=e[t]).key,r=s._id||r,n=s._formatterFn,r={content:"{"+r+"}",headers:1<(s._headers||[]).length?'headers="'+s._headers.join(" ")+'"':"",className:this.getClassName("col",r)+" "+(s.className||"")+" "+this.getClassName("cell")+" {"+r+"-className}"},!n&&s.formatter&&(r.content=s.formatter.replace(l,r.content)),s.nodeFormatter&&(r.content=""),o+=u(s.cellTemplate||i,r);this._rowTemplate=u(this.ROW_TEMPLATE,{content:o})},_setColumnsFormatterFn:function(e){for(var t,a,s=h.DataTable.BodyView.Formatters,r=0,n=e.length;r<n;r++)t=(a=e[r]).formatter,!a._formatterFn&&t&&(o.isFunction(t)?a._formatterFn=t:t in s&&(a._formatterFn=s[t].call(this.host||this,a)));return e},_createTBodyNode:function(){return h.Node.create(u(this.TBODY_TEMPLATE,{className:this.getClassName("data")}))},destructor:function(){new h.EventHandle(a.values(this._eventHandles)).detach()},_getRowId:function(e){return this._idMap[e]||(this._idMap[e]=h.guid())},initializer:function(e){this.host=e.host,this._eventHandles={modelListChange:this.after("modelListChange",r("_afterModelListChange",this))},this._idMap={},this.CLASS_ODD=this.getClassName("odd"),this.CLASS_EVEN=this.getClassName("even")}},{Formatters:{}})},"@VERSION@",{requires:["datatable-core","view","classnamemanager"]});