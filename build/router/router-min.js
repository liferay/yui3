YUI.add("router",function(c,t){var a=c.HistoryHash,e=c.QueryString,n=c.Array,s=c.Lang,r=c.Object,i=c.config.win,o=[],h=[],u="ready";function g(){g.superclass.constructor.apply(this,arguments)}c.Router=c.extend(g,c.Base,{_regexURL:/^((?:[^\/#?:]+:\/\/|\/\/)[^\/]*)?([^?#]*)(\?[^#]*)?(#.*)?$/,_regexPathParam:/([:*])([\w\-]+)?/g,_regexUrlQuery:/\?([^#]*).*$/,_regexUrlOrigin:/^(?:[^\/#?:]+:\/\/|\/\/)[^\/]*/,initializer:function(t){var e=this;e._html5=e.get("html5"),e._params={},e._routes=[],e._url=e._getURL(),e._setRoutes(t&&t.routes?t.routes:e.get("routes")),e._html5?(e._history=new c.HistoryHTML5({force:!0}),e._historyEvents=c.after("history:change",e._afterHistoryChange,e)):e._historyEvents=c.on("hashchange",e._afterHistoryChange,i,e),e.publish(u,{defaultFn:e._defReadyFn,fireOnce:!0,preventable:!1}),e.once("initializedChange",function(){c.once("load",function(){setTimeout(function(){e.fire(u,{dispatched:!!e._dispatched})},20)})}),o.push(this)},destructor:function(){var t=n.indexOf(o,this);-1<t&&o.splice(t,1),this._historyEvents&&this._historyEvents.detach()},dispatch:function(){return this.once(u,function(){var t,e;this._ready=!0,this.upgrade()||(t=this._getRequest("dispatch"),e=this._getResponse(t),this._dispatch(t,e))}),this},getPath:function(){return this._getPath()},hasRoute:function(t){var e,r;return!!this._hasSameOrigin(t)&&(this._html5||(t=this._upgradeURL(t)),t=this.removeQuery(t.replace(this._regexUrlOrigin,"")),!!(r=this.match(t)).length)&&(e=this.removeRoot(t),!!n.filter(r,function(t){return this._getParamValues(t,e)},this).length)},match:function(e){var t=this.get("root");if(t){if(!this._pathHasRoot(t,e))return[];e=this.removeRoot(e)}return n.filter(this._routes,function(t){return-1<e.search(t.regex)})},param:function(t,e){return this._params[t]=e,this},removeRoot:function(t){var e,r=this.get("root");return t=t.replace(this._regexUrlOrigin,""),!r||"/"===(t=(e=this.removeQuery(t))!==r&&!this._pathHasRoot(r,e)?t:t.substring(r.length)).charAt(0)?t:"/"+t},removeQuery:function(t){return t.replace(/\?.*$/,"")},replace:function(t){return this._queue(t,!0)},route:function(t,e){var r,i;return e=n(arguments,1,!0),t="string"==typeof t||s.isRegExp(t)?{callbacks:e=n.flatten(e),keys:r=[],path:t,regex:i=this._getRegex(t,r)}:(e=n.flatten([t.callbacks||t.callback||[]].concat(e)),r=t.keys,i=(i=t.regex||t.regexp)||this._getRegex(t.path,r=[]),c.merge(t,{callbacks:e,keys:r,path:t.path||i,regex:i})),this._routes.push(t),this},save:function(t){return this._queue(t)},upgrade:function(){var t;return!!this._html5&&!!(t=this._getHashPath())&&(this.once(u,function(){this.replace(t)}),!0)},_decode:function(t){return decodeURIComponent(t.replace(/\+/g," "))},_dequeue:function(){var t,e=this;return YUI.Env.windowLoaded?(t=h.shift())?t():this:(c.once("load",function(){e._dequeue()}),this)},_dispatch:function(r,i){var n,s,a=this,o=a.match(r.path),h=[];return a._dispatching=a._dispatched=!0,o&&o.length?(n=a.removeRoot(r.path),function u(t){var e;t?"route"===t?(h=[],u()):c.error(t):(t=h.shift())?("string"!=typeof t||(t=a[e=t])||c.error("Router: Callback not found: "+e,null,"router"),r.pendingCallbacks=h.length,t.call(a,r,i,u)):(e=o.shift())&&((s=a._getParamValues(e,n))?(r.params=s,r.route=e,r.pendingRoutes=o.length,h=e.callbacks.concat(),u()):u("route"))}(),a._dispatching=!1,a._dequeue()):(a._dispatching=!1,a)},_getHashPath:function(t){return(t=t||a.getHash())&&"/"===t.charAt(0)?this._joinURL(t):""},_getOrigin:function(){var t=c.getLocation();return t.origin||t.protocol+"//"+t.host},_getParams:function(){return c.merge(this._params)},_getParamValues:function(t,e){var i,e=n.map(t.regex.exec(e)||[],function(t){return t&&this._decode(t)||""},this);return e.length-1!==t.keys.length?e:(i=n.hash(t.keys,e.slice(1)),!!n.every(t.keys,function(t){var e=this._params[t],r=i[t];return!e||!r||"string"!=typeof r||!(!1===(r=s.isRegExp(e)?e.exec(r):e.call(this,r,t))||!s.isValue(r)||(i[t]=r,0))},this)&&i)},_getPath:function(){var t=!this._html5&&this._getHashPath()||c.getLocation().pathname;return this.removeQuery(t)},_getPathRoot:function(){var t=c.getLocation().pathname;return"/"===t.charAt(t.length-1)?t:((t=t.split("/")).pop(),t.join("/")+"/")},_getQuery:function(){var t,e,r=c.getLocation();return!this._html5&&(e=(t=a.getHash()).match(this._regexUrlQuery),t)&&e?e[1]:r.search.substring(1)},_getRegex:function(t,i){return s.isRegExp(t)?t:"*"===t?/.*/:(t=t.replace(this._regexPathParam,function(t,e,r){return r?(i.push(r),"*"===e?"(.*?)":"([^/#?]+)"):"*"===e?".*":t}),new RegExp("^"+t+"$"))},_getRequest:function(t){return{path:this._getPath(),query:this._parseQuery(this._getQuery()),url:this._getURL(),router:this,src:t}},_getResponse:function(t){return{req:t}},_getRoutes:function(){return this._routes.concat()},_getURL:function(){var t=c.getLocation().toString();return t=this._html5?t:this._upgradeURL(t)},_hasSameOrigin:function(t){t=(t&&t.match(this._regexUrlOrigin)||[])[0];return!(t=t&&0===t.indexOf("//")?c.getLocation().protocol+t:t)||t===this._getOrigin()},_joinURL:function(t){var e=this.get("root");return"/"===(t=this.removeRoot(t)).charAt(0)&&(t=t.substring(1)),e&&"/"===e.charAt(e.length-1)?e+t:e+"/"+t},_normalizePath:function(t){var e,r,i,n,s,a,o="/";if(!t||t===o)return o;for(a=[],e=0,r=(n=t.split(o)).length;e<r;++e)".."===(s=n[e])?a.pop():s&&a.push(s);return(i=o+a.join(o))!==o&&t.charAt(t.length-1)===o&&(i+=o),i},_parseQuery:e&&e.parse?e.parse:function(t){for(var e,r=this._decode,i=t.split("&"),n=0,s=i.length,a={};n<s;++n)(e=i[n].split("="))[0]&&(a[r(e[0])]=r(e[1]||""));return a},_pathHasRoot:function(t,e){t="/"===t.charAt(t.length-1)?t:t+"/";return 0===e.indexOf(t)},_queue:function(){var t=arguments,e=this;return h.push(function(){return e._html5?c.UA.ios&&c.UA.ios<5?e._save.apply(e,t):setTimeout(function(){e._save.apply(e,t)},1):(e._dispatching=!0,e._save.apply(e,t)),e}),this._dispatching?this:this._dequeue()},_resolvePath:function(t){return t?("/"!==t.charAt(0)&&(t=this._getPathRoot()+t),this._normalizePath(t)
):c.getLocation().pathname},_resolveURL:function(t){var e,r,i,t=t&&t.match(this._regexURL);return t?(i=t[1],e=t[2],r=t[3],t=t[4],i?(i=0===i.indexOf("//")?c.getLocation().protocol+i:i)+(e||"/")+(r||"")+(t||""):(i=this._getOrigin()+this._resolvePath(e),e||r?i+(r||"")+(t||""):i+((r=this._getQuery())?"?"+r:"")+(t||""))):c.getLocation().toString()},_save:function(t,e){var r,i,n,s="string"==typeof t;return s&&!this._hasSameOrigin(t)?c.error("Security error: The new URL must be of the same origin as the current URL."):(s&&(t=this._joinURL(t)),this._ready=!0,this._html5?this._history[e?"replace":"add"](null,{url:t}):(r=c.getLocation().pathname,i=this.get("root"),n=a.getHash(),s||(t=n),(t=i!==r&&i!==this._getPathRoot()?t:this.removeRoot(t))===n?c.Router.dispatch():a[e?"replaceHash":"setHash"](t))),this},_setParams:function(t){return this._params={},r.each(t,function(t,e){this.param(e,t)},this),c.merge(this._params)},_setRoutes:function(t){return this._routes=[],n.each(t,function(t){this.route(t)},this),this._routes.concat()},_upgradeURL:function(t){var e,r;return this._hasSameOrigin(t)&&(e=(t.match(/#(.*)$/)||[])[1]||"",e=(r=c.HistoryHash.hashPrefix)&&0===e.indexOf(r)?e.replace(r,""):e)&&(r=this._getHashPath(e))?this._resolveURL(r):t},_afterHistoryChange:function(t){var e=this,t=t.src,r=e._url,i=e._getURL();e._url=i,("popstate"!==t||e._ready&&r.replace(/#.*$/,"")!==i.replace(/#.*$/,""))&&(r=e._getRequest(t),i=e._getResponse(r),e._dispatch(r,i))},_defReadyFn:function(t){this._ready=!0}},{NAME:"router",ATTRS:{html5:{valueFn:function(){return c.Router.html5},writeOnce:"initOnly"},params:{value:{},getter:"_getParams",setter:"_setParams"},root:{value:""},routes:{value:[],getter:"_getRoutes",setter:"_setRoutes"}},html5:c.HistoryBase.html5&&(!c.UA.android||3<=c.UA.android),_instances:o,dispatch:function(){for(var t,e,r,i=0,n=o.length;i<n;i+=1)(t=o[i])&&(e=t._getRequest("dispatch"),r=t._getResponse(e),t._dispatch(e,r))}}),c.Controller=c.Router},"@VERSION@",{optional:["querystring-parse"],requires:["array-extras","base-build","history"]});