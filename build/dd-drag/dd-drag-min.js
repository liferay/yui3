YUI.add("dd-drag",function(l,t){var s=l.DD.DDM,o="node",a="dragging",n="dragNode",r="offsetHeight",h="offsetWidth",e="drag:mouseDown",i="drag:afterMouseDown",d="drag:removeHandle",u="drag:addHandle",g="drag:removeInvalid",c="drag:addInvalid",_="drag:start",f="drag:end",p="drag:drag",v="drag:align",m=function(t){this._lazyAddAttrs=!1,m.superclass.constructor.apply(this,arguments),s._regDrag(this)||l.error("Failed to register node, already in use: "+t.node)};m.NAME="drag",m.START_EVENT="mousedown",m.ATTRS={node:{setter:function(t){if(this._canDrag(t))return t;var e=l.one(t);return e||l.error("DD.Drag: Invalid Node Given: "+t),e}},dragNode:{setter:function(t){if(this._canDrag(t))return t;var e=l.one(t);return e||l.error("DD.Drag: Invalid dragNode Given: "+t),e}},offsetNode:{value:!0},startCentered:{value:!1},clickPixelThresh:{value:s.get("clickPixelThresh")},clickTimeThresh:{value:s.get("clickTimeThresh")},lock:{value:!1,setter:function(t){return t?this.get(o).addClass(s.CSS_PREFIX+"-locked"):this.get(o).removeClass(s.CSS_PREFIX+"-locked"),t}},data:{value:!1},move:{value:!0},useShim:{value:!0},activeHandle:{value:!1},primaryButtonOnly:{value:!0},dragging:{value:!1},parent:{value:!1},target:{value:!1,setter:function(t){return this._handleTarget(t),t}},dragMode:{value:null,setter:function(t){return s._setDragMode(t)}},groups:{value:["default"],getter:function(){return this._groups?l.Object.keys(this._groups):(this._groups={},[])},setter:function(t){return this._groups=l.Array.hash(t),t}},handles:{value:null,setter:function(t){return t?(this._handles={},l.Array.each(t,function(t){var e=t;(t instanceof l.Node||t instanceof l.NodeList)&&(e=t._yuid),this._handles[e]=t,this._fixUserSelect(t)},this)):this._handles=null,t}},bubbles:{setter:function(t){return this.addTarget(t),t}},haltDown:{value:!0}},l.extend(m,l.Base,{_canDrag:function(t){return!!(t&&t.setXY&&t.getXY&&t.test&&t.contains)},_bubbleTargets:l.DD.DDM,addToGroup:function(t){return this._groups[t]=!0,s._activateTargets(),this},removeFromGroup:function(t){return delete this._groups[t],s._activateTargets(),this},target:null,_handleTarget:function(t){l.DD.Drop&&(!1===t?this.target&&(s._unregTarget(this.target),this.target=null):((t=l.Lang.isObject(t)?t:{}).bubbleTargets=t.bubbleTargets||this.getTargets(),t.node=this.get(o),t.groups=t.groups||this.get("groups"),this.target=new l.DD.Drop(t)))},_groups:null,_createEvents:function(){this.publish(e,{defaultFn:this._defMouseDownFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"}),this.publish(v,{defaultFn:this._defAlignFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"}),this.publish(p,{defaultFn:this._defDragFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"}),this.publish(f,{defaultFn:this._defEndFn,preventedFn:this._prevEndFn,queuable:!1,emitFacade:!0,bubbles:!0,prefix:"drag"}),l.Array.each([i,d,u,g,c,_,"drag:drophit","drag:dropmiss","drag:over","drag:enter","drag:exit"],function(t){this.publish(t,{type:t,emitFacade:!0,bubbles:!0,preventable:!1,queuable:!1,prefix:"drag"})},this)},_ev_md:null,_startTime:null,_endTime:null,_handles:null,_invalids:null,_invalidsDefault:{textarea:!0,input:!0,a:!0,button:!0,select:!0},_dragThreshMet:null,_fromTimeout:null,_clickTimeout:null,deltaXY:null,startXY:null,nodeXY:null,lastXY:null,actXY:null,realXY:null,mouseXY:null,region:null,_handleMouseUp:function(){this.fire("drag:mouseup"),this._fixIEMouseUp(),s.activeDrag&&s._end()},_fixDragStart:function(t){this.validClick(t)&&t.preventDefault()},_fixUserSelect:function(t,e){t=l.all(t);t&&(e?t.setStyles({"-moz-user-select":"auto","-ms-user-select":"auto","-webkit-user-select":"auto","user-select":"auto"}):t.setStyles({"-moz-user-select":"none","-ms-user-select":"none","-webkit-user-select":"none","user-select":"none"}))},_ieSelectFix:function(){return!1},_ieSelectBack:null,_fixIEMouseDown:function(){l.UA.ie&&(this._ieSelectBack=l.config.doc.body.onselectstart,l.config.doc.body.onselectstart=this._ieSelectFix)},_fixIEMouseUp:function(){l.UA.ie&&(l.config.doc.body.onselectstart=this._ieSelectBack)},_handleMouseDownEvent:function(t){this.validClick(t)&&t.preventDefault(),this.fire(e,{ev:t})},_defMouseDownFn:function(t){var e,t=t.ev;if(this._dragThreshMet=!1,this._ev_md=t,this.get("primaryButtonOnly")&&1<t.button)return!1;this.validClick(t)&&(this._fixIEMouseDown(t),t.touches||(this.get("haltDown")?t.halt():t.preventDefault()),this._setStartPosition([t.pageX,t.pageY]),e=(s.activeDrag=this).get("clickTimeThresh"),t.touches&&(e=Math.max(750,e)),this._clickTimeout=l.later(e,this,this._timeoutCheck)),this.fire(i,{ev:t})},validClick:function(t){var i=!1,e=!1,s=t.target,a=null,n=null,r=null,h=!1;return this._handles?l.Object.each(this._handles,function(t,e){t instanceof l.Node||t instanceof l.NodeList?i||(r=(r=t)instanceof l.Node?new l.NodeList(t._node):r).each(function(t){t.contains(s)&&(i=!0)}):l.Lang.isString(e)&&s.test(e+", "+e+" *")&&!a&&(a=e,i=!0)}):((e=this.get(o)).contains(s)||e.compareTo(s))&&(i=!0),i&&this._invalids&&l.Object.each(this._invalids,function(t,e){l.Lang.isString(e)&&s.test(e+", "+e+" *")&&(i=!1)}),i&&(a?(n=t.currentTarget.all(a),h=!1,n.each(function(t){!t.contains(s)&&!t.compareTo(s)||h||(h=!0,this.set("activeHandle",t))},this)):this.set("activeHandle",this.get(o))),i},_setStartPosition:function(t){this.startXY=t,this.nodeXY=this.lastXY=this.realXY=this.get(o).getXY(),this.get("offsetNode")?this.deltaXY=[this.startXY[0]-this.nodeXY[0],this.startXY[1]-this.nodeXY[1]]:this.deltaXY=[0,0]},_timeoutCheck:function(){this.get("lock")||this._dragThreshMet||!this._ev_md||(this._fromTimeout=this._dragThreshMet=!0,this.start(),this._alignNode([this._ev_md.pageX,this._ev_md.pageY],!0))},removeHandle:function(t){var e=t;return(t instanceof l.Node||t instanceof l.NodeList)&&(e=t._yuid),this._handles[e]&&(delete this._handles[e],this._fixUserSelect(t,!0),this.fire(d,{handle:t})),this},addHandle:function(t){this._handles||(this._handles={});var e=t;return(t instanceof l.Node||t instanceof l.NodeList)&&(
e=t._yuid),this._handles[e]=t,this._fixUserSelect(t),this.fire(u,{handle:t}),this},removeInvalid:function(t){return this._invalids[t]&&(this._invalids[t]=null,delete this._invalids[t],this.fire(g,{handle:t})),this},addInvalid:function(t){return l.Lang.isString(t)&&(this._invalids[t]=!0,this.fire(c,{handle:t})),this},initializer:function(){var t;(this.get(o).dd=this).get(o).get("id")||(t=l.stamp(this.get(o)),this.get(o).set("id",t)),this.actXY=[],this._invalids=l.clone(this._invalidsDefault,!0),this._createEvents(),this.get(n)||this.set(n,this.get(o)),this.on("initializedChange",l.bind(this._prep,this)),this.set("groups",this.get("groups"))},_prep:function(){this._dragThreshMet=!1;var t=this.get(o);t.addClass(s.CSS_PREFIX+"-draggable"),t.on(m.START_EVENT,l.bind(this._handleMouseDownEvent,this)),t.on("mouseup",l.bind(this._handleMouseUp,this)),t.on(["dragstart","touchmove"],l.bind(this._fixDragStart,this))},_unprep:function(){var t=this.get(o);t.removeClass(s.CSS_PREFIX+"-draggable"),t.detachAll("mouseup"),t.detachAll("dragstart"),t.detachAll(m.START_EVENT),this.mouseXY=[],this.deltaXY=[0,0],this.startXY=[],this.nodeXY=[],this.lastXY=[],this.actXY=[],this.realXY=[]},start:function(){var t,e,i;return this.get("lock")||this.get(a)||(e=this.get(o),this._startTime=(new Date).getTime(),s._start(),e.addClass(s.CSS_PREFIX+"-dragging"),this.fire(_,{pageX:this.nodeXY[0],pageY:this.nodeXY[1],startTime:this._startTime}),e=this.get(n),i=this.nodeXY,t=e.get(h),e=e.get(r),this.get("startCentered")&&this._setStartPosition([i[0]+t/2,i[1]+e/2]),this.region={0:i[0],1:i[1],area:0,top:i[1],right:i[0]+t,bottom:i[1]+e,left:i[0]},this.set(a,!0)),this},end:function(){return this._endTime=(new Date).getTime(),this._clickTimeout&&this._clickTimeout.cancel(),this._dragThreshMet=this._fromTimeout=!1,!this.get("lock")&&this.get(a)&&this.fire(f,{pageX:this.lastXY[0],pageY:this.lastXY[1],startTime:this._startTime,endTime:this._endTime}),this.get(o).removeClass(s.CSS_PREFIX+"-dragging"),this.set(a,!1),this.deltaXY=[0,0],this},_defEndFn:function(){this._fixIEMouseUp(),this._ev_md=null},_prevEndFn:function(){this._fixIEMouseUp(),this.get(n).setXY(this.nodeXY),this._ev_md=null,this.region=null},_align:function(t){this.fire(v,{pageX:t[0],pageY:t[1]})},_defAlignFn:function(t){this.actXY=[t.pageX-this.deltaXY[0],t.pageY-this.deltaXY[1]]},_alignNode:function(t,e){this._align(t),e||this._moveNode()},_moveNode:function(t){var e=[],i=[],s=this.nodeXY,a=this.actXY;e[0]=a[0]-this.lastXY[0],e[1]=a[1]-this.lastXY[1],i[0]=a[0]-this.nodeXY[0],i[1]=a[1]-this.nodeXY[1],this.region={0:a[0],1:a[1],area:0,top:a[1],right:a[0]+this.get(n).get(h),bottom:a[1]+this.get(n).get(r),left:a[0]},this.fire(p,{pageX:a[0],pageY:a[1],scroll:t,info:{start:s,xy:a,delta:e,offset:i}}),this.lastXY=a},_defDragFn:function(t){var e;this.get("move")&&(t.scroll&&t.scroll.node&&((e=t.scroll.node.getDOMNode())===l.config.win?e.scrollTo(t.scroll.left,t.scroll.top):(t.scroll.node.set("scrollTop",t.scroll.top),t.scroll.node.set("scrollLeft",t.scroll.left))),this.get(n).setXY([t.pageX,t.pageY]),this.realXY=[t.pageX,t.pageY])},_move:function(t){if(this.get("lock"))return!1;var e,i;this.mouseXY=[t.pageX,t.pageY],this._dragThreshMet||t.touches?this._dragThreshMet&&(this._clickTimeout&&this._clickTimeout.cancel(),this._alignNode([t.pageX,t.pageY])):(e=Math.abs(this.startXY[0]-t.pageX),i=Math.abs(this.startXY[1]-t.pageY),(e>this.get("clickPixelThresh")||i>this.get("clickPixelThresh"))&&(this._dragThreshMet=!0,this.start(),this._alignNode([t.pageX,t.pageY])))},stopDrag:function(){return this.get(a)&&s._end(),this},destructor:function(){this._unprep(),this.target&&this.target.destroy(),s._unregDrag(this)}}),l.namespace("DD"),l.DD.Drag=m},"@VERSION@",{requires:["dd-ddm-base","selector-css2"]});